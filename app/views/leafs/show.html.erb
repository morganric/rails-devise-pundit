<% meta_keywords @leaf.tag_list %>
<% meta_description @leaf.copy %>

<div class="clearfix row">

  <div class="col-md-8">
      <div id="leaderboard" class="pull-left ads">
        <%= dfp_tag :leaderboard %>

      </div>
       <h1>
          <%= link_to @leaf.title, @leaf.url, :target => "_blank", :class => "click" %>
        <small>via <%= link_to @leaf.user.profile.display_name, vanity_url_path(@leaf.user.profile) %></small>
        </h1>

      <% if @leaf.via_url && @leaf.embed_code != nil %>
        <div class="flex-video">
          <%= @leaf.embed_code.html_safe %>
        </div>
      <% else %>
        <% if @leaf.type === 'photo' %>
        <p> 
          <%= image_tag(@leaf.image.url(:photo), :class => "img-rounded img-thumbnail") %>
        </p>
        <% end %>

        <% if @leaf.type === 'audio' %>
          <audio controls>
            <source src="<%= @leaf.audio %>" type="audio/mp3">
          Your browser does not support the audio element.
          </audio>
        <% end %>

        <% if @leaf.type === 'video' %>
          <video width="320" height="240" controls poster="<%= @leaf.image.url %>">
            <source src="<%= @leaf.video %>" type="video/mp4">
          </video>
        <% end %>

      <% end %>

    <section class="panel panel-default">
    <p class="well">
      <%= @leaf.copy %>
    </p>
    </section>
        
  </div>
  <div class="col-md-4 pull-right" id="sidebar">

    <p>
      <%# if @leaf.via_url %>
        <%#= link_to image_tag(@leaf.thumbnail_url, :style => "max-width: 300px;" ), @leaf.url, :target => "_blank", :class => "click"  %>
      <%# else %>
          <%= link_to image_tag(@leaf.image.url(:square)), @leaf.url, :target => "_blank", :class => "click"  %>
      <%# end %>
    </p>
    <ul class="nav social_buttons clearfix">
        <li><%= tweet_button( :text => truncate(@leaf.title, lenght: 100 ), via: "embedtree", :count => "horizontal" ) %></li>
        <li><%= like_button(1440239169528450) %></li>
        <li><%= pinit_button %></li>
        <li><%= google_plus_button %></li>
    </ul>
    <br/>
    <% if current_user %>
      <% if UserFav.where(:user_id => current_user.id, :leaf_id => @leaf.id).exists? %>
          <%= link_to raw("<i class='glyphicon glyphicon-heart-empty'></i>  Un-Favourite"), delete_user_favs_path(:user_fav => {:leaf_id => @leaf.id,:user_id => current_user.id}), :remote => true, class: "btn btn-default", :method => :delete %>
      <% else %>
        <%= link_to raw("<i class='glyphicon glyphicon-heart'></i>  Favourite"), user_favs_path(:user_fav => {:leaf_id => @leaf.id,:user_id => current_user.id}), :remote => true, class: "btn btn-default", :method => :post %>
      <% end %>
     <% end %> 
       <p>
          <%= render 'sidebar', leaf: @leaf %>
       </p>
      
  </div>
</div>

<% if current_user %>
<div id="leaf_id" class="hidden"><%= @leaf.id %></div>
<div id="user_id" class="hidden"><%= current_user.id %></div>
<% end %> 

